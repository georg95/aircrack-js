const std = @import("std");
const mem = std.mem;

pub fn sha1(input: *const [16]u32, IV: [5]u32) [5]u32 {
    var w: [16]u32 = undefined;
    @memcpy(w[0..], input);
    var a: u32 = IV[0];
    var b: u32 = IV[1];
    var c: u32 = IV[2];
    var d: u32 = IV[3];
    var e: u32 = IV[4];
    var t: u32 = 0;
    e = ((a << 5) | (a >> 27)) +% ((b & c) | ((~b) & d)) +% e +% 1518500249 +% w[0];
    b = (b << 30) | (b >> 2);
    d = ((e << 5) | (e >> 27)) +% ((a & b) | ((~a) & c)) +% d +% 1518500249 +% w[1];
    a = (a << 30) | (a >> 2);
    c = ((d << 5) | (d >> 27)) +% ((e & a) | ((~e) & b)) +% c +% 1518500249 +% w[2];
    e = (e << 30) | (e >> 2);
    b = ((c << 5) | (c >> 27)) +% ((d & e) | ((~d) & a)) +% b +% 1518500249 +% w[3];
    d = (d << 30) | (d >> 2);
    a = ((b << 5) | (b >> 27)) +% ((c & d) | ((~c) & e)) +% a +% 1518500249 +% w[4];
    c = (c << 30) | (c >> 2);
    e = ((a << 5) | (a >> 27)) +% ((b & c) | ((~b) & d)) +% e +% 1518500249 +% w[5];
    b = (b << 30) | (b >> 2);
    d = ((e << 5) | (e >> 27)) +% ((a & b) | ((~a) & c)) +% d +% 1518500249 +% w[6];
    a = (a << 30) | (a >> 2);
    c = ((d << 5) | (d >> 27)) +% ((e & a) | ((~e) & b)) +% c +% 1518500249 +% w[7];
    e = (e << 30) | (e >> 2);
    b = ((c << 5) | (c >> 27)) +% ((d & e) | ((~d) & a)) +% b +% 1518500249 +% w[8];
    d = (d << 30) | (d >> 2);
    a = ((b << 5) | (b >> 27)) +% ((c & d) | ((~c) & e)) +% a +% 1518500249 +% w[9];
    c = (c << 30) | (c >> 2);
    e = ((a << 5) | (a >> 27)) +% ((b & c) | ((~b) & d)) +% e +% 1518500249 +% w[10];
    b = (b << 30) | (b >> 2);
    d = ((e << 5) | (e >> 27)) +% ((a & b) | ((~a) & c)) +% d +% 1518500249 +% w[11];
    a = (a << 30) | (a >> 2);
    c = ((d << 5) | (d >> 27)) +% ((e & a) | ((~e) & b)) +% c +% 1518500249 +% w[12];
    e = (e << 30) | (e >> 2);
    b = ((c << 5) | (c >> 27)) +% ((d & e) | ((~d) & a)) +% b +% 1518500249 +% w[13];
    d = (d << 30) | (d >> 2);
    a = ((b << 5) | (b >> 27)) +% ((c & d) | ((~c) & e)) +% a +% 1518500249 +% w[14];
    c = (c << 30) | (c >> 2);
    e = ((a << 5) | (a >> 27)) +% ((b & c) | ((~b) & d)) +% e +% 1518500249 +% w[15];
    b = (b << 30) | (b >> 2);
    t = w[13] ^ w[8] ^ w[2] ^ w[0];
    w[0] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% ((a & b) | ((~a) & c)) +% d +% 1518500249 +% w[0];
    a = (a << 30) | (a >> 2);
    t = w[14] ^ w[9] ^ w[3] ^ w[1];
    w[1] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% ((e & a) | ((~e) & b)) +% c +% 1518500249 +% w[1];
    e = (e << 30) | (e >> 2);
    t = w[15] ^ w[10] ^ w[4] ^ w[2];
    w[2] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% ((d & e) | ((~d) & a)) +% b +% 1518500249 +% w[2];
    d = (d << 30) | (d >> 2);
    t = w[0] ^ w[11] ^ w[5] ^ w[3];
    w[3] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% ((c & d) | ((~c) & e)) +% a +% 1518500249 +% w[3];
    c = (c << 30) | (c >> 2);
    t = w[1] ^ w[12] ^ w[6] ^ w[4];
    w[4] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% (b ^ c ^ d) +% e +% 1859775393 +% w[4];
    b = (b << 30) | (b >> 2);
    t = w[2] ^ w[13] ^ w[7] ^ w[5];
    w[5] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% (a ^ b ^ c) +% d +% 1859775393 +% w[5];
    a = (a << 30) | (a >> 2);
    t = w[3] ^ w[14] ^ w[8] ^ w[6];
    w[6] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% (e ^ a ^ b) +% c +% 1859775393 +% w[6];
    e = (e << 30) | (e >> 2);
    t = w[4] ^ w[15] ^ w[9] ^ w[7];
    w[7] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% (d ^ e ^ a) +% b +% 1859775393 +% w[7];
    d = (d << 30) | (d >> 2);
    t = w[5] ^ w[0] ^ w[10] ^ w[8];
    w[8] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% (c ^ d ^ e) +% a +% 1859775393 +% w[8];
    c = (c << 30) | (c >> 2);
    t = w[6] ^ w[1] ^ w[11] ^ w[9];
    w[9] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% (b ^ c ^ d) +% e +% 1859775393 +% w[9];
    b = (b << 30) | (b >> 2);
    t = w[7] ^ w[2] ^ w[12] ^ w[10];
    w[10] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% (a ^ b ^ c) +% d +% 1859775393 +% w[10];
    a = (a << 30) | (a >> 2);
    t = w[8] ^ w[3] ^ w[13] ^ w[11];
    w[11] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% (e ^ a ^ b) +% c +% 1859775393 +% w[11];
    e = (e << 30) | (e >> 2);
    t = w[9] ^ w[4] ^ w[14] ^ w[12];
    w[12] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% (d ^ e ^ a) +% b +% 1859775393 +% w[12];
    d = (d << 30) | (d >> 2);
    t = w[10] ^ w[5] ^ w[15] ^ w[13];
    w[13] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% (c ^ d ^ e) +% a +% 1859775393 +% w[13];
    c = (c << 30) | (c >> 2);
    t = w[11] ^ w[6] ^ w[0] ^ w[14];
    w[14] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% (b ^ c ^ d) +% e +% 1859775393 +% w[14];
    b = (b << 30) | (b >> 2);
    t = w[12] ^ w[7] ^ w[1] ^ w[15];
    w[15] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% (a ^ b ^ c) +% d +% 1859775393 +% w[15];
    a = (a << 30) | (a >> 2);
    t = w[13] ^ w[8] ^ w[2] ^ w[0];
    w[0] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% (e ^ a ^ b) +% c +% 1859775393 +% w[0];
    e = (e << 30) | (e >> 2);
    t = w[14] ^ w[9] ^ w[3] ^ w[1];
    w[1] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% (d ^ e ^ a) +% b +% 1859775393 +% w[1];
    d = (d << 30) | (d >> 2);
    t = w[15] ^ w[10] ^ w[4] ^ w[2];
    w[2] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% (c ^ d ^ e) +% a +% 1859775393 +% w[2];
    c = (c << 30) | (c >> 2);
    t = w[0] ^ w[11] ^ w[5] ^ w[3];
    w[3] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% (b ^ c ^ d) +% e +% 1859775393 +% w[3];
    b = (b << 30) | (b >> 2);
    t = w[1] ^ w[12] ^ w[6] ^ w[4];
    w[4] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% (a ^ b ^ c) +% d +% 1859775393 +% w[4];
    a = (a << 30) | (a >> 2);
    t = w[2] ^ w[13] ^ w[7] ^ w[5];
    w[5] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% (e ^ a ^ b) +% c +% 1859775393 +% w[5];
    e = (e << 30) | (e >> 2);
    t = w[3] ^ w[14] ^ w[8] ^ w[6];
    w[6] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% (d ^ e ^ a) +% b +% 1859775393 +% w[6];
    d = (d << 30) | (d >> 2);
    t = w[4] ^ w[15] ^ w[9] ^ w[7];
    w[7] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% (c ^ d ^ e) +% a +% 1859775393 +% w[7];
    c = (c << 30) | (c >> 2);
    t = w[5] ^ w[0] ^ w[10] ^ w[8];
    w[8] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% ((b & c) | (b & d) | (c & d)) +% e +% 2400959708 +% w[8];
    b = (b << 30) | (b >> 2);
    t = w[6] ^ w[1] ^ w[11] ^ w[9];
    w[9] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% ((a & b) | (a & c) | (b & c)) +% d +% 2400959708 +% w[9];
    a = (a << 30) | (a >> 2);
    t = w[7] ^ w[2] ^ w[12] ^ w[10];
    w[10] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% ((e & a) | (e & b) | (a & b)) +% c +% 2400959708 +% w[10];
    e = (e << 30) | (e >> 2);
    t = w[8] ^ w[3] ^ w[13] ^ w[11];
    w[11] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% ((d & e) | (d & a) | (e & a)) +% b +% 2400959708 +% w[11];
    d = (d << 30) | (d >> 2);
    t = w[9] ^ w[4] ^ w[14] ^ w[12];
    w[12] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% ((c & d) | (c & e) | (d & e)) +% a +% 2400959708 +% w[12];
    c = (c << 30) | (c >> 2);
    t = w[10] ^ w[5] ^ w[15] ^ w[13];
    w[13] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% ((b & c) | (b & d) | (c & d)) +% e +% 2400959708 +% w[13];
    b = (b << 30) | (b >> 2);
    t = w[11] ^ w[6] ^ w[0] ^ w[14];
    w[14] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% ((a & b) | (a & c) | (b & c)) +% d +% 2400959708 +% w[14];
    a = (a << 30) | (a >> 2);
    t = w[12] ^ w[7] ^ w[1] ^ w[15];
    w[15] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% ((e & a) | (e & b) | (a & b)) +% c +% 2400959708 +% w[15];
    e = (e << 30) | (e >> 2);
    t = w[13] ^ w[8] ^ w[2] ^ w[0];
    w[0] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% ((d & e) | (d & a) | (e & a)) +% b +% 2400959708 +% w[0];
    d = (d << 30) | (d >> 2);
    t = w[14] ^ w[9] ^ w[3] ^ w[1];
    w[1] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% ((c & d) | (c & e) | (d & e)) +% a +% 2400959708 +% w[1];
    c = (c << 30) | (c >> 2);
    t = w[15] ^ w[10] ^ w[4] ^ w[2];
    w[2] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% ((b & c) | (b & d) | (c & d)) +% e +% 2400959708 +% w[2];
    b = (b << 30) | (b >> 2);
    t = w[0] ^ w[11] ^ w[5] ^ w[3];
    w[3] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% ((a & b) | (a & c) | (b & c)) +% d +% 2400959708 +% w[3];
    a = (a << 30) | (a >> 2);
    t = w[1] ^ w[12] ^ w[6] ^ w[4];
    w[4] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% ((e & a) | (e & b) | (a & b)) +% c +% 2400959708 +% w[4];
    e = (e << 30) | (e >> 2);
    t = w[2] ^ w[13] ^ w[7] ^ w[5];
    w[5] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% ((d & e) | (d & a) | (e & a)) +% b +% 2400959708 +% w[5];
    d = (d << 30) | (d >> 2);
    t = w[3] ^ w[14] ^ w[8] ^ w[6];
    w[6] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% ((c & d) | (c & e) | (d & e)) +% a +% 2400959708 +% w[6];
    c = (c << 30) | (c >> 2);
    t = w[4] ^ w[15] ^ w[9] ^ w[7];
    w[7] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% ((b & c) | (b & d) | (c & d)) +% e +% 2400959708 +% w[7];
    b = (b << 30) | (b >> 2);
    t = w[5] ^ w[0] ^ w[10] ^ w[8];
    w[8] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% ((a & b) | (a & c) | (b & c)) +% d +% 2400959708 +% w[8];
    a = (a << 30) | (a >> 2);
    t = w[6] ^ w[1] ^ w[11] ^ w[9];
    w[9] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% ((e & a) | (e & b) | (a & b)) +% c +% 2400959708 +% w[9];
    e = (e << 30) | (e >> 2);
    t = w[7] ^ w[2] ^ w[12] ^ w[10];
    w[10] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% ((d & e) | (d & a) | (e & a)) +% b +% 2400959708 +% w[10];
    d = (d << 30) | (d >> 2);
    t = w[8] ^ w[3] ^ w[13] ^ w[11];
    w[11] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% ((c & d) | (c & e) | (d & e)) +% a +% 2400959708 +% w[11];
    c = (c << 30) | (c >> 2);
    t = w[9] ^ w[4] ^ w[14] ^ w[12];
    w[12] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% (b ^ c ^ d) +% e +% 3395469782 +% w[12];
    b = (b << 30) | (b >> 2);
    t = w[10] ^ w[5] ^ w[15] ^ w[13];
    w[13] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% (a ^ b ^ c) +% d +% 3395469782 +% w[13];
    a = (a << 30) | (a >> 2);
    t = w[11] ^ w[6] ^ w[0] ^ w[14];
    w[14] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% (e ^ a ^ b) +% c +% 3395469782 +% w[14];
    e = (e << 30) | (e >> 2);
    t = w[12] ^ w[7] ^ w[1] ^ w[15];
    w[15] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% (d ^ e ^ a) +% b +% 3395469782 +% w[15];
    d = (d << 30) | (d >> 2);
    t = w[13] ^ w[8] ^ w[2] ^ w[0];
    w[0] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% (c ^ d ^ e) +% a +% 3395469782 +% w[0];
    c = (c << 30) | (c >> 2);
    t = w[14] ^ w[9] ^ w[3] ^ w[1];
    w[1] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% (b ^ c ^ d) +% e +% 3395469782 +% w[1];
    b = (b << 30) | (b >> 2);
    t = w[15] ^ w[10] ^ w[4] ^ w[2];
    w[2] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% (a ^ b ^ c) +% d +% 3395469782 +% w[2];
    a = (a << 30) | (a >> 2);
    t = w[0] ^ w[11] ^ w[5] ^ w[3];
    w[3] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% (e ^ a ^ b) +% c +% 3395469782 +% w[3];
    e = (e << 30) | (e >> 2);
    t = w[1] ^ w[12] ^ w[6] ^ w[4];
    w[4] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% (d ^ e ^ a) +% b +% 3395469782 +% w[4];
    d = (d << 30) | (d >> 2);
    t = w[2] ^ w[13] ^ w[7] ^ w[5];
    w[5] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% (c ^ d ^ e) +% a +% 3395469782 +% w[5];
    c = (c << 30) | (c >> 2);
    t = w[3] ^ w[14] ^ w[8] ^ w[6];
    w[6] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% (b ^ c ^ d) +% e +% 3395469782 +% w[6];
    b = (b << 30) | (b >> 2);
    t = w[4] ^ w[15] ^ w[9] ^ w[7];
    w[7] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% (a ^ b ^ c) +% d +% 3395469782 +% w[7];
    a = (a << 30) | (a >> 2);
    t = w[5] ^ w[0] ^ w[10] ^ w[8];
    w[8] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% (e ^ a ^ b) +% c +% 3395469782 +% w[8];
    e = (e << 30) | (e >> 2);
    t = w[6] ^ w[1] ^ w[11] ^ w[9];
    w[9] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% (d ^ e ^ a) +% b +% 3395469782 +% w[9];
    d = (d << 30) | (d >> 2);
    t = w[7] ^ w[2] ^ w[12] ^ w[10];
    w[10] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% (c ^ d ^ e) +% a +% 3395469782 +% w[10];
    c = (c << 30) | (c >> 2);
    t = w[8] ^ w[3] ^ w[13] ^ w[11];
    w[11] = (t << 1) | (t >> 31);
    e = ((a << 5) | (a >> 27)) +% (b ^ c ^ d) +% e +% 3395469782 +% w[11];
    b = (b << 30) | (b >> 2);
    t = w[9] ^ w[4] ^ w[14] ^ w[12];
    w[12] = (t << 1) | (t >> 31);
    d = ((e << 5) | (e >> 27)) +% (a ^ b ^ c) +% d +% 3395469782 +% w[12];
    a = (a << 30) | (a >> 2);
    t = w[10] ^ w[5] ^ w[15] ^ w[13];
    w[13] = (t << 1) | (t >> 31);
    c = ((d << 5) | (d >> 27)) +% (e ^ a ^ b) +% c +% 3395469782 +% w[13];
    e = (e << 30) | (e >> 2);
    t = w[11] ^ w[6] ^ w[0] ^ w[14];
    w[14] = (t << 1) | (t >> 31);
    b = ((c << 5) | (c >> 27)) +% (d ^ e ^ a) +% b +% 3395469782 +% w[14];
    d = (d << 30) | (d >> 2);
    t = w[12] ^ w[7] ^ w[1] ^ w[15];
    w[15] = (t << 1) | (t >> 31);
    a = ((b << 5) | (b >> 27)) +% (c ^ d ^ e) +% a +% 3395469782 +% w[15];
    c = (c << 30) | (c >> 2);
    return [_]u32{ IV[0] +% a, IV[1] +% b, IV[2] +% c, IV[3] +% d, IV[4] +% e };
}

var IV_ = [_]u32{ 0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0 };

const Vec = @Vector(4, u32);

pub fn pbkdf2_loop(seed1: [5]Vec, seed2: [5]Vec, init_r: [5]Vec) [16]u32 {
    var w0: Vec = @splat(0);
    var w1: Vec = @splat(0);
    var w2: Vec = @splat(0);
    var w3: Vec = @splat(0);
    var w4: Vec = @splat(0);
    var w5: Vec = @splat(0);
    var w6: Vec = @splat(0);
    var w7: Vec = @splat(0);
    var w8: Vec = @splat(0);
    var w9: Vec = @splat(0);
    var w10: Vec = @splat(0);
    var w11: Vec = @splat(0);
    var w12: Vec = @splat(0);
    var w13: Vec = @splat(0);
    var w14: Vec = @splat(0);
    var w15: Vec = @splat(0);
    var dk0: Vec = @splat(0);
    var dk1: Vec = @splat(0);
    var dk2: Vec = @splat(0);
    var dk3: Vec = @splat(0);
    var dk4: Vec = @splat(0);
    var a: Vec = @splat(0);
    var b: Vec = @splat(0);
    var c: Vec = @splat(0);
    var d: Vec = @splat(0);
    var e: Vec = @splat(0);
    var t: Vec = @splat(0);
    w0 = init_r[0];
    w1 = init_r[1];
    w2 = init_r[2];
    w3 = init_r[3];
    w4 = init_r[4];

    dk0 = w0;
    dk1 = w1;
    dk2 = w2;
    dk3 = w3;
    dk4 = w4;
    for (1..4096) |_| {
        a = seed1[0];
        b = seed1[1];
        c = seed1[2];
        d = seed1[3];
        e = seed1[4];
        t = @splat(0);
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | ((~b) & d)) +% e +% @as(Vec, @splat(1518500249)) +% w0;
        b = (b << @splat(30)) | (b >> @splat(2));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | ((~a) & c)) +% d +% @as(Vec, @splat(1518500249)) +% w1;
        a = (a << @splat(30)) | (a >> @splat(2));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | ((~e) & b)) +% c +% @as(Vec, @splat(1518500249)) +% w2;
        e = (e << @splat(30)) | (e >> @splat(2));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | ((~d) & a)) +% b +% @as(Vec, @splat(1518500249)) +% w3;
        d = (d << @splat(30)) | (d >> @splat(2));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | ((~c) & e)) +% a +% @as(Vec, @splat(1518500249)) +% w4;
        c = (c << @splat(30)) | (c >> @splat(2));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | ((~b) & d)) +% e +% @as(Vec, @splat(3665983897));
        b = (b << @splat(30)) | (b >> @splat(2));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | ((~a) & c)) +% d +% @as(Vec, @splat(1518500249));
        a = (a << @splat(30)) | (a >> @splat(2));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | ((~e) & b)) +% c +% @as(Vec, @splat(1518500249));
        e = (e << @splat(30)) | (e >> @splat(2));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | ((~d) & a)) +% b +% @as(Vec, @splat(1518500249));
        d = (d << @splat(30)) | (d >> @splat(2));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | ((~c) & e)) +% a +% @as(Vec, @splat(1518500249));
        c = (c << @splat(30)) | (c >> @splat(2));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | ((~b) & d)) +% e +% @as(Vec, @splat(1518500249));
        b = (b << @splat(30)) | (b >> @splat(2));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | ((~a) & c)) +% d +% @as(Vec, @splat(1518500249));
        a = (a << @splat(30)) | (a >> @splat(2));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | ((~e) & b)) +% c +% @as(Vec, @splat(1518500249));
        e = (e << @splat(30)) | (e >> @splat(2));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | ((~d) & a)) +% b +% @as(Vec, @splat(1518500249));
        d = (d << @splat(30)) | (d >> @splat(2));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | ((~c) & e)) +% a +% @as(Vec, @splat(1518500249));
        c = (c << @splat(30)) | (c >> @splat(2));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | ((~b) & d)) +% e +% @as(Vec, @splat(1518500921));
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w0 ^ w2;
        w0 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | ((~a) & c)) +% d +% @as(Vec, @splat(1518500249)) +% w0;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w1 ^ w3;
        w1 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | ((~e) & b)) +% c +% @as(Vec, @splat(1518500249)) +% w1;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w2 ^ w4 ^ @as(Vec, @splat(672));
        w2 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | ((~d) & a)) +% b +% @as(Vec, @splat(1518500249)) +% w2;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w3 ^ w0 ^ @as(Vec, @splat(2147483648));
        w3 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | ((~c) & e)) +% a +% @as(Vec, @splat(1518500249)) +% w3;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w4 ^ w1;
        w4 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(1859775393)) +% w4;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w2 ^ @as(Vec, @splat(2147483648));
        w5 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(1859775393)) +% w5;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w3;
        w6 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(1859775393)) +% w6;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w4 ^ @as(Vec, @splat(672));
        w7 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(1859775393)) +% w7;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w5 ^ w0;
        w8 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(1859775393)) +% w8;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w6 ^ w1;
        w9 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(1859775393)) +% w9;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w7 ^ w2;
        w10 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(1859775393)) +% w10;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w8 ^ w3;
        w11 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(1859775393)) +% w11;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w9 ^ w4;
        w12 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(1859775393)) +% w12;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w10 ^ w5 ^ @as(Vec, @splat(672));
        w13 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(1859775393)) +% w13;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w11 ^ w6 ^ w0;
        w14 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(1859775393)) +% w14;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w12 ^ w7 ^ w1 ^ @as(Vec, @splat(672));
        w15 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(1859775393)) +% w15;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w0 ^ w13 ^ w8 ^ w2;
        w0 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(1859775393)) +% w0;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w1 ^ w14 ^ w9 ^ w3;
        w1 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(1859775393)) +% w1;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w2 ^ w15 ^ w10 ^ w4;
        w2 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(1859775393)) +% w2;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w3 ^ w0 ^ w11 ^ w5;
        w3 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(1859775393)) +% w3;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w4 ^ w1 ^ w12 ^ w6;
        w4 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(1859775393)) +% w4;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w5 ^ w2 ^ w13 ^ w7;
        w5 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(1859775393)) +% w5;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w6 ^ w3 ^ w14 ^ w8;
        w6 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(1859775393)) +% w6;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w7 ^ w4 ^ w15 ^ w9;
        w7 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(1859775393)) +% w7;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w8 ^ w5 ^ w0 ^ w10;
        w8 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | (b & d) | (c & d)) +% e +% @as(Vec, @splat(2400959708)) +% w8;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w9 ^ w6 ^ w1 ^ w11;
        w9 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | (a & c) | (b & c)) +% d +% @as(Vec, @splat(2400959708)) +% w9;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w10 ^ w7 ^ w2 ^ w12;
        w10 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | (e & b) | (a & b)) +% c +% @as(Vec, @splat(2400959708)) +% w10;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w11 ^ w8 ^ w3 ^ w13;
        w11 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | (d & a) | (e & a)) +% b +% @as(Vec, @splat(2400959708)) +% w11;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w12 ^ w9 ^ w4 ^ w14;
        w12 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | (c & e) | (d & e)) +% a +% @as(Vec, @splat(2400959708)) +% w12;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w13 ^ w10 ^ w5 ^ w15;
        w13 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | (b & d) | (c & d)) +% e +% @as(Vec, @splat(2400959708)) +% w13;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w14 ^ w11 ^ w6 ^ w0;
        w14 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | (a & c) | (b & c)) +% d +% @as(Vec, @splat(2400959708)) +% w14;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w15 ^ w12 ^ w7 ^ w1;
        w15 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | (e & b) | (a & b)) +% c +% @as(Vec, @splat(2400959708)) +% w15;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w0 ^ w13 ^ w8 ^ w2;
        w0 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | (d & a) | (e & a)) +% b +% @as(Vec, @splat(2400959708)) +% w0;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w1 ^ w14 ^ w9 ^ w3;
        w1 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | (c & e) | (d & e)) +% a +% @as(Vec, @splat(2400959708)) +% w1;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w2 ^ w15 ^ w10 ^ w4;
        w2 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | (b & d) | (c & d)) +% e +% @as(Vec, @splat(2400959708)) +% w2;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w3 ^ w0 ^ w11 ^ w5;
        w3 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | (a & c) | (b & c)) +% d +% @as(Vec, @splat(2400959708)) +% w3;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w4 ^ w1 ^ w12 ^ w6;
        w4 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | (e & b) | (a & b)) +% c +% @as(Vec, @splat(2400959708)) +% w4;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w5 ^ w2 ^ w13 ^ w7;
        w5 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | (d & a) | (e & a)) +% b +% @as(Vec, @splat(2400959708)) +% w5;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w6 ^ w3 ^ w14 ^ w8;
        w6 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | (c & e) | (d & e)) +% a +% @as(Vec, @splat(2400959708)) +% w6;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w7 ^ w4 ^ w15 ^ w9;
        w7 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | (b & d) | (c & d)) +% e +% @as(Vec, @splat(2400959708)) +% w7;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w8 ^ w5 ^ w0 ^ w10;
        w8 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | (a & c) | (b & c)) +% d +% @as(Vec, @splat(2400959708)) +% w8;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w9 ^ w6 ^ w1 ^ w11;
        w9 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | (e & b) | (a & b)) +% c +% @as(Vec, @splat(2400959708)) +% w9;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w10 ^ w7 ^ w2 ^ w12;
        w10 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | (d & a) | (e & a)) +% b +% @as(Vec, @splat(2400959708)) +% w10;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w11 ^ w8 ^ w3 ^ w13;
        w11 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | (c & e) | (d & e)) +% a +% @as(Vec, @splat(2400959708)) +% w11;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w12 ^ w9 ^ w4 ^ w14;
        w12 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(3395469782)) +% w12;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w13 ^ w10 ^ w5 ^ w15;
        w13 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(3395469782)) +% w13;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w14 ^ w11 ^ w6 ^ w0;
        w14 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(3395469782)) +% w14;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w15 ^ w12 ^ w7 ^ w1;
        w15 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(3395469782)) +% w15;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w0 ^ w13 ^ w8 ^ w2;
        w0 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(3395469782)) +% w0;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w1 ^ w14 ^ w9 ^ w3;
        w1 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(3395469782)) +% w1;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w2 ^ w15 ^ w10 ^ w4;
        w2 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(3395469782)) +% w2;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w3 ^ w0 ^ w11 ^ w5;
        w3 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(3395469782)) +% w3;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w4 ^ w1 ^ w12 ^ w6;
        w4 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(3395469782)) +% w4;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w5 ^ w2 ^ w13 ^ w7;
        w5 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(3395469782)) +% w5;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w6 ^ w3 ^ w14 ^ w8;
        w6 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(3395469782)) +% w6;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w7 ^ w4 ^ w15 ^ w9;
        w7 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(3395469782)) +% w7;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w8 ^ w5 ^ w0 ^ w10;
        w8 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(3395469782)) +% w8;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w9 ^ w6 ^ w1 ^ w11;
        w9 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(3395469782)) +% w9;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w10 ^ w7 ^ w2 ^ w12;
        w10 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(3395469782)) +% w10;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w11 ^ w8 ^ w3 ^ w13;
        w11 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(3395469782)) +% w11;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w12 ^ w9 ^ w4 ^ w14;
        w12 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(3395469782)) +% w12;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w13 ^ w10 ^ w5 ^ w15;
        w13 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(3395469782)) +% w13;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w14 ^ w11 ^ w6 ^ w0;
        w14 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(3395469782)) +% w14;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w15 ^ w12 ^ w7 ^ w1;
        w15 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(3395469782)) +% w15;
        c = (c << @splat(30)) | (c >> @splat(2));
        w0 = seed1[0] +% a;
        w1 = seed1[1] +% b;
        w2 = seed1[2] +% c;
        w3 = seed1[3] +% d;
        w4 = seed1[4] +% e;
        a = seed2[0];
        b = seed2[1];
        c = seed2[2];
        d = seed2[3];
        e = seed2[4];
        t = @splat(0);
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | ((~b) & d)) +% e +% @as(Vec, @splat(1518500249)) +% w0;
        b = (b << @splat(30)) | (b >> @splat(2));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | ((~a) & c)) +% d +% @as(Vec, @splat(1518500249)) +% w1;
        a = (a << @splat(30)) | (a >> @splat(2));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | ((~e) & b)) +% c +% @as(Vec, @splat(1518500249)) +% w2;
        e = (e << @splat(30)) | (e >> @splat(2));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | ((~d) & a)) +% b +% @as(Vec, @splat(1518500249)) +% w3;
        d = (d << @splat(30)) | (d >> @splat(2));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | ((~c) & e)) +% a +% @as(Vec, @splat(1518500249)) +% w4;
        c = (c << @splat(30)) | (c >> @splat(2));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | ((~b) & d)) +% e +% @as(Vec, @splat(3665983897));
        b = (b << @splat(30)) | (b >> @splat(2));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | ((~a) & c)) +% d +% @as(Vec, @splat(1518500249));
        a = (a << @splat(30)) | (a >> @splat(2));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | ((~e) & b)) +% c +% @as(Vec, @splat(1518500249));
        e = (e << @splat(30)) | (e >> @splat(2));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | ((~d) & a)) +% b +% @as(Vec, @splat(1518500249));
        d = (d << @splat(30)) | (d >> @splat(2));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | ((~c) & e)) +% a +% @as(Vec, @splat(1518500249));
        c = (c << @splat(30)) | (c >> @splat(2));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | ((~b) & d)) +% e +% @as(Vec, @splat(1518500249));
        b = (b << @splat(30)) | (b >> @splat(2));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | ((~a) & c)) +% d +% @as(Vec, @splat(1518500249));
        a = (a << @splat(30)) | (a >> @splat(2));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | ((~e) & b)) +% c +% @as(Vec, @splat(1518500249));
        e = (e << @splat(30)) | (e >> @splat(2));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | ((~d) & a)) +% b +% @as(Vec, @splat(1518500249));
        d = (d << @splat(30)) | (d >> @splat(2));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | ((~c) & e)) +% a +% @as(Vec, @splat(1518500249));
        c = (c << @splat(30)) | (c >> @splat(2));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | ((~b) & d)) +% e +% @as(Vec, @splat(1518500921));
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w0 ^ w2;
        w0 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | ((~a) & c)) +% d +% @as(Vec, @splat(1518500249)) +% w0;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w1 ^ w3;
        w1 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | ((~e) & b)) +% c +% @as(Vec, @splat(1518500249)) +% w1;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w2 ^ w4 ^ @as(Vec, @splat(672));
        w2 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | ((~d) & a)) +% b +% @as(Vec, @splat(1518500249)) +% w2;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w3 ^ w0 ^ @as(Vec, @splat(2147483648));
        w3 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | ((~c) & e)) +% a +% @as(Vec, @splat(1518500249)) +% w3;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w4 ^ w1;
        w4 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(1859775393)) +% w4;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w2 ^ @as(Vec, @splat(2147483648));
        w5 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(1859775393)) +% w5;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w3;
        w6 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(1859775393)) +% w6;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w4 ^ @as(Vec, @splat(672));
        w7 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(1859775393)) +% w7;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w5 ^ w0;
        w8 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(1859775393)) +% w8;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w6 ^ w1;
        w9 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(1859775393)) +% w9;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w7 ^ w2;
        w10 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(1859775393)) +% w10;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w8 ^ w3;
        w11 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(1859775393)) +% w11;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w9 ^ w4;
        w12 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(1859775393)) +% w12;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w10 ^ w5 ^ @as(Vec, @splat(672));
        w13 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(1859775393)) +% w13;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w11 ^ w6 ^ w0;
        w14 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(1859775393)) +% w14;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w12 ^ w7 ^ w1 ^ @as(Vec, @splat(672));
        w15 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(1859775393)) +% w15;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w0 ^ w13 ^ w8 ^ w2;
        w0 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(1859775393)) +% w0;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w1 ^ w14 ^ w9 ^ w3;
        w1 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(1859775393)) +% w1;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w2 ^ w15 ^ w10 ^ w4;
        w2 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(1859775393)) +% w2;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w3 ^ w0 ^ w11 ^ w5;
        w3 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(1859775393)) +% w3;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w4 ^ w1 ^ w12 ^ w6;
        w4 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(1859775393)) +% w4;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w5 ^ w2 ^ w13 ^ w7;
        w5 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(1859775393)) +% w5;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w6 ^ w3 ^ w14 ^ w8;
        w6 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(1859775393)) +% w6;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w7 ^ w4 ^ w15 ^ w9;
        w7 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(1859775393)) +% w7;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w8 ^ w5 ^ w0 ^ w10;
        w8 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | (b & d) | (c & d)) +% e +% @as(Vec, @splat(2400959708)) +% w8;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w9 ^ w6 ^ w1 ^ w11;
        w9 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | (a & c) | (b & c)) +% d +% @as(Vec, @splat(2400959708)) +% w9;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w10 ^ w7 ^ w2 ^ w12;
        w10 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | (e & b) | (a & b)) +% c +% @as(Vec, @splat(2400959708)) +% w10;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w11 ^ w8 ^ w3 ^ w13;
        w11 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | (d & a) | (e & a)) +% b +% @as(Vec, @splat(2400959708)) +% w11;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w12 ^ w9 ^ w4 ^ w14;
        w12 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | (c & e) | (d & e)) +% a +% @as(Vec, @splat(2400959708)) +% w12;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w13 ^ w10 ^ w5 ^ w15;
        w13 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | (b & d) | (c & d)) +% e +% @as(Vec, @splat(2400959708)) +% w13;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w14 ^ w11 ^ w6 ^ w0;
        w14 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | (a & c) | (b & c)) +% d +% @as(Vec, @splat(2400959708)) +% w14;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w15 ^ w12 ^ w7 ^ w1;
        w15 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | (e & b) | (a & b)) +% c +% @as(Vec, @splat(2400959708)) +% w15;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w0 ^ w13 ^ w8 ^ w2;
        w0 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | (d & a) | (e & a)) +% b +% @as(Vec, @splat(2400959708)) +% w0;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w1 ^ w14 ^ w9 ^ w3;
        w1 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | (c & e) | (d & e)) +% a +% @as(Vec, @splat(2400959708)) +% w1;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w2 ^ w15 ^ w10 ^ w4;
        w2 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | (b & d) | (c & d)) +% e +% @as(Vec, @splat(2400959708)) +% w2;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w3 ^ w0 ^ w11 ^ w5;
        w3 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | (a & c) | (b & c)) +% d +% @as(Vec, @splat(2400959708)) +% w3;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w4 ^ w1 ^ w12 ^ w6;
        w4 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | (e & b) | (a & b)) +% c +% @as(Vec, @splat(2400959708)) +% w4;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w5 ^ w2 ^ w13 ^ w7;
        w5 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | (d & a) | (e & a)) +% b +% @as(Vec, @splat(2400959708)) +% w5;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w6 ^ w3 ^ w14 ^ w8;
        w6 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | (c & e) | (d & e)) +% a +% @as(Vec, @splat(2400959708)) +% w6;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w7 ^ w4 ^ w15 ^ w9;
        w7 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% ((b & c) | (b & d) | (c & d)) +% e +% @as(Vec, @splat(2400959708)) +% w7;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w8 ^ w5 ^ w0 ^ w10;
        w8 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% ((a & b) | (a & c) | (b & c)) +% d +% @as(Vec, @splat(2400959708)) +% w8;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w9 ^ w6 ^ w1 ^ w11;
        w9 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% ((e & a) | (e & b) | (a & b)) +% c +% @as(Vec, @splat(2400959708)) +% w9;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w10 ^ w7 ^ w2 ^ w12;
        w10 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% ((d & e) | (d & a) | (e & a)) +% b +% @as(Vec, @splat(2400959708)) +% w10;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w11 ^ w8 ^ w3 ^ w13;
        w11 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% ((c & d) | (c & e) | (d & e)) +% a +% @as(Vec, @splat(2400959708)) +% w11;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w12 ^ w9 ^ w4 ^ w14;
        w12 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(3395469782)) +% w12;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w13 ^ w10 ^ w5 ^ w15;
        w13 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(3395469782)) +% w13;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w14 ^ w11 ^ w6 ^ w0;
        w14 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(3395469782)) +% w14;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w15 ^ w12 ^ w7 ^ w1;
        w15 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(3395469782)) +% w15;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w0 ^ w13 ^ w8 ^ w2;
        w0 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(3395469782)) +% w0;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w1 ^ w14 ^ w9 ^ w3;
        w1 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(3395469782)) +% w1;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w2 ^ w15 ^ w10 ^ w4;
        w2 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(3395469782)) +% w2;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w3 ^ w0 ^ w11 ^ w5;
        w3 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(3395469782)) +% w3;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w4 ^ w1 ^ w12 ^ w6;
        w4 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(3395469782)) +% w4;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w5 ^ w2 ^ w13 ^ w7;
        w5 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(3395469782)) +% w5;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w6 ^ w3 ^ w14 ^ w8;
        w6 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(3395469782)) +% w6;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w7 ^ w4 ^ w15 ^ w9;
        w7 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(3395469782)) +% w7;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w8 ^ w5 ^ w0 ^ w10;
        w8 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(3395469782)) +% w8;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w9 ^ w6 ^ w1 ^ w11;
        w9 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(3395469782)) +% w9;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w10 ^ w7 ^ w2 ^ w12;
        w10 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(3395469782)) +% w10;
        c = (c << @splat(30)) | (c >> @splat(2));
        t = w11 ^ w8 ^ w3 ^ w13;
        w11 = (t << @splat(1)) | (t >> @splat(31));
        e = ((a << @splat(5)) | (a >> @splat(27))) +% (b ^ c ^ d) +% e +% @as(Vec, @splat(3395469782)) +% w11;
        b = (b << @splat(30)) | (b >> @splat(2));
        t = w12 ^ w9 ^ w4 ^ w14;
        w12 = (t << @splat(1)) | (t >> @splat(31));
        d = ((e << @splat(5)) | (e >> @splat(27))) +% (a ^ b ^ c) +% d +% @as(Vec, @splat(3395469782)) +% w12;
        a = (a << @splat(30)) | (a >> @splat(2));
        t = w13 ^ w10 ^ w5 ^ w15;
        w13 = (t << @splat(1)) | (t >> @splat(31));
        c = ((d << @splat(5)) | (d >> @splat(27))) +% (e ^ a ^ b) +% c +% @as(Vec, @splat(3395469782)) +% w13;
        e = (e << @splat(30)) | (e >> @splat(2));
        t = w14 ^ w11 ^ w6 ^ w0;
        w14 = (t << @splat(1)) | (t >> @splat(31));
        b = ((c << @splat(5)) | (c >> @splat(27))) +% (d ^ e ^ a) +% b +% @as(Vec, @splat(3395469782)) +% w14;
        d = (d << @splat(30)) | (d >> @splat(2));
        t = w15 ^ w12 ^ w7 ^ w1;
        w15 = (t << @splat(1)) | (t >> @splat(31));
        a = ((b << @splat(5)) | (b >> @splat(27))) +% (c ^ d ^ e) +% a +% @as(Vec, @splat(3395469782)) +% w15;
        c = (c << @splat(30)) | (c >> @splat(2));
        w0 = seed2[0] +% a;
        w1 = seed2[1] +% b;
        w2 = seed2[2] +% c;
        w3 = seed2[3] +% d;
        w4 = seed2[4] +% e;
        dk0 ^= w0;
        dk1 ^= w1;
        dk2 ^= w2;
        dk3 ^= w3;
        dk4 ^= w4;
    }
    return [16]u32{ dk0[0], dk1[0], dk2[0], dk3[0], dk4[0], dk0[1], dk1[1], dk2[1], dk0[2], dk1[2], dk2[2], dk3[2], dk4[2], dk0[3], dk1[3], dk2[3] };
}

pub fn get_seed(paswd: []const u8, xor: u8) [5]u32 {
    var main_buf: [16]u32 = [_]u32{0} ** 16;
    for (0..64) |i| {
        const pbyte = if (i < paswd.len) paswd[i] else 0;
        main_buf[@divFloor(i, 4)] += @as(u32, pbyte ^ xor) << @truncate((3 - (i % 4)) * 8);
    }
    return sha1(main_buf[0..], IV_);
}
pub fn get_init_data(SSID_BUF: *[16]u32, seed1: [5]u32, seed2: [5]u32) [5]u32 {
    const r1: [5]u32 = sha1(SSID_BUF, seed1);
    var main_buf: [16]u32 = [_]u32{0} ** 16;
    for (0..5) |i| main_buf[i] = r1[i];
    main_buf[5] = 0x80000000;
    main_buf[15] = 84 * 8;
    return sha1(main_buf[0..], seed2);
}

pub fn pbkdf2(paswd1: []const u8, paswd2: []const u8) [16]u32 {
    const seed1: [5]u32 = get_seed(paswd1, 0x36);
    const seed2: [5]u32 = get_seed(paswd1, 0x5c);
    const seed3: [5]u32 = get_seed(paswd2, 0x36);
    const seed4: [5]u32 = get_seed(paswd2, 0x5c);

    const r1 = get_init_data(SSID_BUF1[0..], seed1, seed2);
    const r2 = get_init_data(SSID_BUF2[0..], seed1, seed2);
    const r3 = get_init_data(SSID_BUF1[0..], seed3, seed4);
    const r4 = get_init_data(SSID_BUF2[0..], seed3, seed4);

    var s1: [5]Vec = undefined;
    var s2: [5]Vec = undefined;
    var r: [5]Vec = undefined;
    for (0..5) |i| {
        s1[i] = Vec{ seed1[i], seed1[i], seed3[i], seed3[i] };
        s2[i] = Vec{ seed2[i], seed2[i], seed4[i], seed4[i] };
        r[i] = Vec{ r1[i], r2[i], r3[i], r4[i] };
    }
    return pbkdf2_loop(s1, s2, r);
}

fn hmac_seed(password: *[16]u32, XOR: u32) [5]u32 {
    var tmp_buf = [_]u32{0} ** 16;
    for (0..16) |i| tmp_buf[i] = password[i] ^ XOR;
    return sha1(&tmp_buf, IV_);
}

fn calcPtk(pmk: *[8]u32) [5]u32 {
    var tmp_buf = [_]u32{0} ** 16;
    for (0..8) |i| tmp_buf[i] = pmk[i];
    var state = hmac_seed(&tmp_buf, 0x36363636);
    const seed2 = hmac_seed(&tmp_buf, 0x5c5c5c5c);
    state = sha1(PTK_HASHDATA[0..16], state);
    state = sha1(PTK_HASHDATA[16..32], state);
    for (0..5) |i| tmp_buf[i] = state[i];
    for (5..16) |i| tmp_buf[i] = 0;
    tmp_buf[5] = 0x80000000;
    tmp_buf[15] = 84 * 8;
    return sha1(&tmp_buf, seed2);
}

fn calcMic(ptk: [5]u32) [5]u32 {
    var tmp_buf = [_]u32{0} ** 16;
    for (0..4) |i| tmp_buf[i] = ptk[i];
    var state = hmac_seed(&tmp_buf, 0x36363636);
    const seed2 = hmac_seed(&tmp_buf, 0x5c5c5c5c);
    for (0..EAPOL_HASHDATA_LEN) |i| {
        state = sha1(EAPOL_HASHDATA[i * 16 ..][0..16], state);
    }
    for (0..5) |i| tmp_buf[i] = state[i];
    for (5..16) |i| tmp_buf[i] = 0;
    tmp_buf[5] = 0x80000000;
    tmp_buf[15] = 84 * 8;
    return sha1(&tmp_buf, seed2);
}

fn calcPmkid(pmk: *[8]u32) [5]u32 {
    var tmp_buf = [_]u32{0} ** 16;
    for (0..8) |i| tmp_buf[i] = pmk[i];
    var state = hmac_seed(&tmp_buf, 0x36363636);
    const seed2 = hmac_seed(&tmp_buf, 0x5c5c5c5c);
    state = sha1(PMK_NAME_BUF[0..16], state);
    for (0..5) |i| tmp_buf[i] = state[i];
    for (5..16) |i| tmp_buf[i] = 0;
    tmp_buf[5] = 0x80000000;
    tmp_buf[15] = 84 * 8;
    return sha1(&tmp_buf, seed2);
}

test "sha1" {
    var pass: [16]u32 = [_]u32{0} ** 16;
    const res: [5]u32 = sha1(&pass, IV_);
    const resExp = [5]u32{ 2461271269, 1448643821, 1813695822, 3204792168, 167197331 };
    try std.testing.expectEqualSlices(u32, resExp[0..], res[0..]);
}

test "pbkdf2" {
    const passwd1 = "11234223";
    const passwd2 = "11234226";
    const ssid = "Netgear";
    setSsidBuf(ssid);
    const pmk = pbkdf2(passwd1, passwd2);
    var dk_bytes: [64]u8 = undefined;
    for (0..16) |i| mem.writeInt(u32, dk_bytes[i * 4 ..][0..4], pmk[i], .big);
    try std.testing.expectEqualSlices(u8, mnemoToSeed(passwd1, ssid)[0..32], dk_bytes[0..32]);
    try std.testing.expectEqualSlices(u8, mnemoToSeed(passwd2, ssid)[0..32], dk_bytes[32..64]);
}
pub fn setSsidBuf(ssid: []const u8) void {
    SSID_BUF1 = [_]u32{0} ** 16;
    var block_bytes: *[64]u8 = @ptrCast(&SSID_BUF1);
    @memcpy(block_bytes[0..ssid.len], ssid);
    block_bytes[ssid.len + 3] = 1;
    block_bytes[ssid.len + 4] = 0x80;
    for (0..16) |i| SSID_BUF1[i] = @byteSwap(SSID_BUF1[i]);
    SSID_BUF1[15] = @truncate((68 + ssid.len) * 8);

    SSID_BUF2 = [_]u32{0} ** 16;
    var block_bytes2: *[64]u8 = @ptrCast(&SSID_BUF2);
    @memcpy(block_bytes2[0..ssid.len], ssid);
    block_bytes2[ssid.len + 3] = 2;
    block_bytes2[ssid.len + 4] = 0x80;
    for (0..16) |i| SSID_BUF2[i] = @byteSwap(SSID_BUF2[i]);
    SSID_BUF2[15] = @truncate((68 + ssid.len) * 8);
}
fn mnemoToSeed(paswd: []const u8, seed: []const u8) [32]u8 {
    var res: [32]u8 = undefined;
    std.crypto.pwhash.pbkdf2(&res, paswd, seed, 4096, std.crypto.auth.hmac.HmacSha1) catch unreachable;
    return res;
}

test "pbkdf-hmac-sha1+eapol" {
    SSID_BUF1 = [_]u32{ 1214345835, 1869505902, 1, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 608 };
    SSID_BUF2 = [_]u32{ 1214345835, 1869505902, 2, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 608 };
    PTK_HASHDATA = [_]u32{ 1348561266, 2003399525, 543909241, 543520880, 1634628457, 1869479936, 323419698, 201331820, 2118156322, 1481945156, 1306767110, 3511233413, 696578124, 4129770510, 840480872, 391546445, 3080738137, 378258341, 3742947102, 4217644019, 1074302379, 2652611259, 3313916384, 2067227824, 3733286912, 2147483648, 0, 0, 0, 0, 0, 1312 };
    EAPOL_HASHDATA = [_]u32{ 16973941, 33622528, 268435456, 0, 22615691, 3282427672, 3609131876, 603144200, 2376834587, 2730214790, 1507883831, 1689312901, 1879048192, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5680, 335609856, 262931457, 4012, 67174400, 262930945, 8388608, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1480, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };
    EAPOL_HASHDATA_LEN = 3;
    EXPECTED_MIC = [_]u32{ 2474584346, 3896858003, 387660936, 1324511926, 488096956 };

    const pass1 = "test";
    const pass2 = "";
    @memcpy(password1[0..pass1.len], pass1);
    @memcpy(password2[0..pass2.len], pass2);
    try std.testing.expectEqual(1, pbkdf1_eapol(pass1.len, pass2.len));
}
test "pbkdf-hmac-sha1+pmkid" {
    SSID_BUF1 = [_]u32{ 1297042737, 1, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 576 };
    SSID_BUF2 = [_]u32{ 1297042737, 2, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 576 };
    PMK_NAME_BUF = [_]u32{ 1347242784, 1315007845, 2173298, 2736324641, 11228585, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 672 };
    EXPECTED_PMKID = [_]u32{ 402982421, 3563370659, 2368904345, 4192947124 };

    const pass1 = "";
    const pass2 = "MOM12345";
    @memcpy(password1[0..pass1.len], pass1);
    @memcpy(password2[0..pass2.len], pass2);
    try std.testing.expectEqual(1, pbkdf2_pmkid(pass1.len, pass2.len));
}

export var password1: [64]u8 = undefined;
export var password2: [64]u8 = undefined;
export var SSID_BUF1: [16]u32 = undefined;
export var SSID_BUF2: [16]u32 = undefined;
export var PTK_HASHDATA: [32]u32 = undefined;
export var EAPOL_HASHDATA: [64]u32 = undefined;
export var EAPOL_HASHDATA_LEN: u32 = 0;
export var EXPECTED_MIC: [5]u32 = undefined;
export var EXPECTED_PMKID: [4]u32 = undefined;
export var PMK_NAME_BUF: [16]u32 = undefined;

export fn pbkdf1_eapol(passLen1: u32, passLen2: u32) u32 {
    var pmk = pbkdf2(password1[0..passLen1], password2[0..passLen2]);
    for (0..2) |i| {
        const ptk = calcPtk(pmk[i * 8 ..][0..8]);
        const mic = calcMic(ptk);
        if (std.mem.eql(u32, EXPECTED_MIC[0..4], mic[0..4])) {
            return @intCast(i);
        }
    }
    return 0xffffffff;
}
export fn pbkdf2_pmkid(passLen1: u32, passLen2: u32) u32 {
    var pmk = pbkdf2(password1[0..passLen1], password2[0..passLen2]);
    for (0..2) |i| {
        const pmkid = calcPmkid(pmk[i * 8 ..][0..8]);
        if (std.mem.eql(u32, EXPECTED_PMKID[0..4], pmkid[0..4])) {
            return @intCast(i);
        }
    }
    return 0xffffffff;
}
